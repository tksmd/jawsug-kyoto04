<!doctype html>
<html lang="ja">

	<head>
		<meta charset="utf-8">

		<title>Getting Started with Fabric</title>

		<meta name="author" content="SOMEDA Takashi">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/simple.css" id="theme">
		<link rel="stylesheet" href="css/jawsug.css">		

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

<script src="js/prototype.js" language="JavaScript" type="text/javascript"></script>
<script src="js/qtp_poster.js" language="JavaScript" type="text/javascript"></script>
<link href="css/qtp_poster.css" rel="StyleSheet" type="text/css" />


		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section>
					<h2 style="padding-bottom:200px;">Getting Started with Fabric</h2>
					<h3>JAWS-UG Kyoto #4</h3>
					<p style='padding-top:20px;'>
					  <small>12th June 2013</small><br/>
					  <small>by SOMEDA Takashi</small>
					  <small>(<a href='http://d.hatena.ne.jp/tksmd'>id:tksmd</a> / <a href="http://twitter.com/tksmd">@tksmd</a>)</small>
					</p>
				</section>

				<section>
				  <section>
				    <h2>Work</h2>
				    <ul>
				      <li>working at <a href='http://nulab-inc.com/'>Nulab, Inc</a></li>
				      <li class="fragment shrink">server and software engineer of <a href='http://backlogtool.com/'>Backlog</a> and <a href='http://cacoo.com/'>Cacoo</a></li>
				      <li class="fragment fade-in"><span class="big">evangelist of Nulab,Inc</span></li>				      
				    </ul>
				  </section>

				  <section>
				    <h2>Cacoo AWS Stencil</h2>
				    <p><a href="https://cacoo.com/store/items/10246">AWS Simple Icons v2.1</a> released</p>
				    <img src="./img/icon.png" height="400px"/>
				    <p class="note"><a href="https://cacoo.com/store/items/10006">Old version</a> is still available, too.</p>				    
				  </section>				  

				  <section>
				    <h2>Community</h2>
				    <ul>
				      <li><a href='http://jawsug-kyoto.g.hatena.ne.jp/'>JAWS-UG Kyoto Branch</a></li>
				      <li><a href='http://kanjava.com'>Kansai Java Engeneer no kai</a></li>
				    </ul>
				  </section>
				</section>

				<section>
				  <section>
				    <h2>Fabric</h2>
				    <ul>
				      <li><a href='http://fabfile.org/'>fabfile.org</a></li>
				      <li>written in Python (Python 2.5 or higher)</li>
				      <li>Simple framework for 
				      	<ul>
				      		<li>application deployment</li>
				      		<li>systems administration tasks</li>
				      	</ul>
				      </li>
				      <li>Latest version is 1.6.1</li>
				    </ul>
				  </section>
				  <section>
				    <h2>Example</h2>
				    <p>fabfile.py</p>
					<pre><code data-trim contenteditable>
from fabric.api import task,local

@task
def whoami():
    local("who am i")
					</code></pre>
				    <p>Execute!</p>
					<pre><code data-trim contenteditable>
$ fab whoami
[localhost] local: who am i
someda   ttys000  Jun 11 23:30 

Done.
					</code></pre>					
				  </section>
				  <section>
				    <h2>Feature</h2>
				    <ul>
				      <li>simple</li>
				      <li>small (few dependencies)</li>
				      <li>installation <span style="font-size:1.2em;">NOT</span> required on server</li>
				    </ul>
				  </section>
				  <section>
				    <h2>Similar Tools</h2>
				    <ul>
				      <li class="fragment shrink"><a href="https://github.com/capistrano/capistrano">Capistrano</a></li>
				      <li class="fragment shrink"><a href="http://www.opscode.com/chef/">Chef</a></li>
				      <li class="fragment grow"><a href="https://github.com/kentaro/cinnamon">Cinnamon</a>
				      	<ul>
				      		<li class="fragment fade-in">about Cinnamon, see <a href="http://d.hatena.ne.jp/naoya/20130118/1358477523" target="_blank">this post</a>
				      		</li>
				      	</ul>
				      </li>				      
				    </ul>

				  </section>
				</section>

				<section>
				  <section>
				    <h2>How we use</h2>
				    <p>Application deployment/Continuous Delivery</p>
				    <img src='https://cacoo.com/diagrams/jWUx2NzA587z1Sif-D780C.png' height="400px">
				  </section>
				</section>

				<section>
				  <h2>Why we choose it</h2>
				  <ul>
				    <li>Easy to start</li>
				    <li>Easy migration from shell script</li>
				    <li>Easy integration with <a href="https://github.com/boto/boto" target="_blank">boto</a></li>
				    <li class="fragment"><span class="big">We love Python.</span></li>
				  </ul>
				</section>

				<section>
				  <section>
				    <h2>Before to start</h2>
				    <p>Are you familier with Python?</p>
				    <p class="note">Amazon Linux AMI release 2013.03 premised</p>    

				    <ul class="fragment">
				    	<li>Yes &rarr;</li>
				    	<li>No &darr;</li>
				    </ul>
				  </section>
				  <section>
				    <h2>Install Python</h2>
				    <p>Setup <a href="https://github.com/yyuu/pyenv">pyenv</a> beforehand</p>
					<pre><code data-trim contenteditable>
$ cd
$ git clone git://github.com/yyuu/pyenv.git .pyenv
$ echo 'export PATH="$HOME/.pyenv/bin:$PATH"' >> ~/.bash_profile
$ echo 'eval "$(pyenv init -)"' >> ~/.bash_profile
</code></pre>
				<p>reload shell and install Python</p>
					<pre><code data-trim contenteditable>
$ pyenv install 2.7.5
$ pyenv rehash
$ pyenv global 2.7.5
$ pyenv versions
</code></pre>
				  </section>
				  <section>
				    <h2>Troubleshooting</h2>
				    <p>Build tools</p>
					<pre><code data-trim contenteditable>
$ sudo yum install gcc make patch -y
$ sudo yum install subversion git -y
</code></pre>
				    <p>Prerequisites</p>
					<pre><code data-trim contenteditable>
$ sudo yum install readline-devel-y
$ sudo yum install sqlite-devel -y
$ sudo yum install zlib-devel bzip2-devel -y
$ sudo yum install openssl-devel -y
</code></pre>
				  </section>
				</section>

				<section>
				  <section>
				    <h2>Install Fabric</h2>
					<pre><code contenteditable>
$ pip install fabric
$ pyenv rehash
$ which fab
</code></pre>
					<p>to upgrade</p>
					<pre><code contenteditable>					
$ pip install --upgrade fabric					
$ fab -V
Fabric 1.6.1
Paramiko 1.10.1
</code></pre>
			  </section>
				</section>

				<section>
				  <section>
				    <h2>Define Tasks</h2>
				    <p>Create fabfile.py and add tasks</p>
					<pre><code contenteditable>
from fabric.api import task,local,run

@task
def localtime():
	local("date")

@task
def remotetime():
	run("date")

def private():
	print("private method")
</code></pre>
					<p class="note">use <a href="http://docs.fabfile.org/en/1.6/usage/tasks.html#new-style-tasks">new style task</a> to distinguish tasks and other private functions clearly</p>
				  </section>
				  <section>
				  	<h2>Execute Task</h2>
				    <p>List your tasks on fabfile.py</p>
					<pre><code contenteditable>
$ fab -l
Available commands:

    localtime
    remotetime
</code></pre>				    
					<p>Execute specified task by passing its name as argument to fab</p>
					<pre><code contenteditable>
$ fab localtime
[localhost] local: date
2013年 6月12日 水曜日 03時50分53秒 JST

Done.

</code></pre>					
				  </section>
				</section>


			<section>
            	<section>
				  <h2>Run Command</h2>
				  <p>only 3 methods to run command</p>
				  <dl class="command">
				  	<dd>execute on remote host</dd><dt><pre><code content editable>run("uname -a")</code></pre></dt>
				  	<dd>execute on remote host with sudo</dd><dt><pre><code content editable>sudo("/etc/init.d/httpd graceful")</code></pre></dt>
				  	<dd>execute on local</dd><dt><pre><code content editable>local("ls -la")</code></pre></dt>
				  </dl>
				</section>

				<section>
				  <h2>Define remote hosts</h2>
				  <p>command line agument</p>
					<pre><code contenteditable>
# globally
$ fab remotetime -H ec2-user@ec2-XX.ap-northeast-1.compute.amazonaws.com
# per task
$ fab remotetime:hosts="ec2-user@ec2-XX.ap-northeast-1.compute.amazonaws.com"
</code></pre>
				  <p>global definition on fabfile</p>
					<pre><code contenteditable>
from fabric.api import env

env.hosts = ['ec2-user@ec2-XX.ap-northeast-1.compute.amazonaws.com']
</code></pre>				  

				  <p>per task definition on fabfile</p>
					<pre><code contenteditable>
from fabric.api import task,run,hosts

@hosts('ec2-user@ec2-XX.ap-northeast-1.compute.amazonaws.com')
@task
def remotetime():
	run("date")
</code></pre>
				</section>

            	<section>
				  <h2>Simplify host definition</h2>
				  <p>prepare ssh config</p>
					<pre><code contenteditable>
# saved as ssh.config
Host web01
  User ec2-user
  HostName ec2-XX.ap-northeast-1.compute.amazonaws.com						
</code></pre>
<p class="note">Available options are limited compared to actual ssh, see <a href="http://docs.fabfile.org/en/1.6/usage/execution.html#leveraging-native-ssh-config-files">details</a></p>
				<p>enable ssh config loading</p>
					<pre><code contenteditable>
from fabric.api import task,local,run,hosts,env

env.use_ssh_config = True
env.ssh_config_path = 'ssh.config'
</code></pre>
				<p>execute with shortened name</p>
					<pre><code contenteditable>
$ fab remotetime -H web01						
</code></pre>				
				</section>				
			</section>

				<section>
				  <h2>Work with boto</h2>
				  <p>integrate with AWS API like</p>
				  <ul>
				    <li>Start/Stop instances</li>
				    <li>Attach/Detach EBS</li>
				    <li>Create/Delete Snapshot</li>
				  </ul>
				</section>

				<section>
				<section>
				  <h2>Demo</h2>
				  <p>para para manga</p>
				  <img src="https://cacoo.com/diagrams/og7AsQcq9nnxYLEy-CBBCC.png" height="400">
				</section>				
				<section>
					<h2>Image movie (not implemented)</h2>
					<a href="jawsug04-demo-img.mov" rel="qtposter">
	<img src="jawsug04-demo-img.jpg" width="768" height="496" alt="jawsug04-demo-img"/>
</a>
				  <p class="note">Powered by <a href="http://matome.naver.jp/odai/2136237151316016701">Cacoo art</a>
				</section>

				</section>


				<section>
					<h2>References</h2>
					<ul>
						<li><a href="http://fabfile.org/">fabric</a></li>
						<li><a href="https://github.com/boto/boto">boto</a></li>
						<li><a href="http://tksmd.github.io/jawsug-kyoto04/">Today's presentation slides</a></li>
					</ul>
				</section>

				<section>
					<h1>Thanks!</h1>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>
		<script src="lib/jquery-1.8.2.min.js"></script>
		<script type="js/jawsug.js"></script>
		
		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
